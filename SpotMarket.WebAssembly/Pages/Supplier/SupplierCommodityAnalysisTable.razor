@using SpotMarket.WebAssembly.Models.Presentation

<div class="card analysis-table-widget">
    <div class="card-header">
        <h5 class="card-title mb-0">تحلیل عملکرد کالاها</h5>
    </div>
    <div class="card-body p-0">
        @if (Data?.Items != null && Data.Items.Any())
        {
            <div class="analysis-table-container">
                <!-- Table Header for Desktop -->
                <div class="analysis-row header-row d-none d-md-grid">
                    <div class="header-cell">کالا</div>
                    <div class="header-cell">تناوب عرضه</div>
                    <div class="header-cell">حجم متوسط</div>
                    <div class="header-cell">نرخ موفقیت</div>
                    <div class="header-cell">وضعیت فروش</div>
                    <div class="header-cell">میانگین رقابت</div>
                    <div class="header-cell">مقایسه قیمت</div>
                </div>

                <!-- Table Body -->
                @foreach (var item in Data.Items)
                {
                    <div class="analysis-row data-row">
                        <div class="data-cell commodity-name-cell">
                            <span class="mobile-label">کالا:</span>
                            <strong>@item.CommodityName</strong>
                        </div>
                        <div class="data-cell">
                            <span class="mobile-label">تناوب عرضه:</span>
                            @item.OfferFrequency
                        </div>
                        <div class="data-cell">
                            <span class="mobile-label">حجم متوسط:</span>
                            @item.AverageOfferVolume
                        </div>
                        <div class="data-cell success-rate-cell">
                            <span class="mobile-label">نرخ موفقیت:</span>
                            <div class="progress-bar-container" title="@($"{item.SuccessRate:F0}%")">
                                <div class="progress-bar-fill" style="width: @(item.SuccessRate)%;"></div>
                            </div>
                        </div>
                        <div class="data-cell">
                            <span class="mobile-label">وضعیت فروش:</span>
                            @item.SellThroughStatus
                        </div>
                        <div class="data-cell">
                            <span class="mobile-label">میانگین رقابت:</span>
                            @($"{item.AverageCompetition:F1}%")
                        </div>
                        <div class="data-cell">
                            <span class="mobile-label">مقایسه قیمت:</span>
                            <span class="price-comparison-badge @GetPriceStatusClass(item.CompetitorPriceStatus)">
                                @item.CompetitorPriceComparison
                            </span>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <p class="text-center p-3">اطلاعاتی برای نمایش وجود ندارد.</p>
        }
    </div>
</div>

@code {
    [Parameter]
    public SupplierCommodityAnalysisData? Data { get; set; }

    private string GetPriceStatusClass(PriceComparisonStatus status) => status switch
    {
        PriceComparisonStatus.Higher => "status-higher",
        PriceComparisonStatus.Lower => "status-lower",
        PriceComparisonStatus.Similar => "status-similar",
        _ => "status-na"
    };
}