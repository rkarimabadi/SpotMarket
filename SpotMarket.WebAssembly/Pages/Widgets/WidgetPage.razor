@page "/widgets"
@inject NavStateService NavState

<MarketSearch OnSearchStateChanged="HandleSearchStateChange" />
@if (!isSearching)
{
<MarketAdvanceProgressBarWidget/>
<MarketProgressBarWidget/>
<MarketAlarmsWidget/>
<MarketCompassWidget/>
<MarketConditionsWidget/>
<MarketContactsWidget/>
<MarketControlWidget/>
<MarketExcitementWidget Data="marketExcitementData" />
<MarketListWidget/>
<MarketMetricsWidget/>
<MarketMoversWidget Data="marketMoversData" />
<NewsWidget Data="newsData" />
<MarketPulseWidget Data="marketPulseData" />
<MainPlayersWidget Players="mainPlayersData" />
<IndustryComparisonWidget/>
<MarketRingsWidget/>
<MarketScheduleWidget/>
<MarketSignalsWidget/>
<MarketSentimentWidget Data="marketSentimentData" />
<MarketShortcutsWidget/>
<MarketSnapshotsWidget/>
<MarketStatsRowWidget/>
<TradingHallsWidget Data="tradingHallsData" />
<SupplyRiskWidget Data="supplyRiskData" />
<MarketVitalsWidget/>
<WatchlistWidget/>
}
@code {
    private bool isSearching;

    private IEnumerable<MainPlayer> mainPlayersData = new List<MainPlayer>();
    private MarketExcitementData? marketExcitementData;
    private MarketMoversData? marketMoversData;
    private MarketPulseData? marketPulseData;
    private MarketSentimentData? marketSentimentData;
    private SupplyRiskData? supplyRiskData;
    private TradingHallsData? tradingHallsData;
    private NewsData? newsData;

    protected override void OnInitialized()
    {
        NavState.SetNavState("ویجت‌ها", true);
        loadDemoData();
    }
    private void HandleSearchStateChange(bool searching)
    {
        isSearching = searching;
        StateHasChanged();
    }
    private void loadDemoData()
    {
        mainPlayersData = new List<MainPlayer>
        {
           new()
           {
               Type = "برترین کارگزار",
               Name = "کارگزاری مفید",
               IconCssClass = "bi bi-person-workspace",
               MarketShare = 18.4m
           },
           new()
           {
               Type = "برترین عرضه‌کننده",
               Name = "فولاد مبارکه",
               IconCssClass = "bi bi-buildings-fill",
               MarketShare = 25.1m
           }
        };
        marketExcitementData = new MarketExcitementData
        {
           Title = "تقاضای بالا",
           Description = "بخش عمده معاملات امروز به روش حراج باز انجام شده که نشان‌دهنده رقابت شدید و هیجان در بازار است.",
           Percentage = 70,
           Label = "حراج"
        };
        marketMoversData = new MarketMoversData
        {
           CompetitionItems = new List<MarketMoverItem>
           {
               new() { Rank = 1, Title = "ورق گالوانیزه", Subtitle = "فولاد مبارکه", Value = "+۱۲.۵٪", ValueState = ValueState.Positive },
               new() { Rank = 2, Title = "مس کاتد", Subtitle = "شرکت ملی مس", Value = "+۹.۸٪", ValueState = ValueState.Positive }
           },
           DemandItems = new List<MarketMoverItem>
           {
               new() { Rank = 1, Title = "سیمان تیپ ۲", Subtitle = "سیمان تهران", Value = "۳.۵x", ValueState = ValueState.Neutral },
               new() { Rank = 2, Title = "پلی‌پروپیلن", Subtitle = "پتروشیمی مارون", Value = "۲.۸x", ValueState = ValueState.Neutral }
           }
        };
        marketPulseData = new MarketPulseData
        {
            Items = new List<PulseCardItem>
            {
                new() { Title = "ارزش معاملات", Value = "۱۲.۳ همت", Change = "+۱.۵٪", ChangeState = ValueState.Positive },
                new() { Title = "شاخص رقابت", Value = "۸.۲٪", Change = "-۰.۳٪", ChangeState = ValueState.Negative }
            }
        };
        marketSentimentData = new MarketSentimentData
        {
           Items = new List<SentimentItem>
           {
               new() { Name = "نقدی", Percentage = 65, ColorCssVariable = "var(--primary-color)" },
               new() { Name = "سلف", Percentage = 25, ColorCssVariable = "var(--success-color)" },
               new() { Name = "نسیه", Percentage = 10, ColorCssVariable = "var(--warning-color)" }
           }
        };
        supplyRiskData =  new SupplyRiskData
        {
           Items = new List<SupplyRiskItem>
           {
               new()
               {
                   Title = "مس کاتد",
                   Subtitle = "ریسک بالا",
                   RiskLevel = RiskLevel.High,
                   Value = "۱ عرضه‌کننده"
               },
               new()
               {
                   Title = "میلگرد",
                   Subtitle = "ریسک پایین",
                   RiskLevel = RiskLevel.Low,
                   Value = "۱۲ عرضه‌کننده"
               }
           }
        };
        tradingHallsData = new TradingHallsData
        {
           Items = new List<TradingHallItem>
           {
               new() { Title = "صنعتی", IconCssClass = "bi bi-building", IconBgCssClass = "industrial", Value = "۵.۸ همت", Change = "+۳.۱٪", ChangeState = ValueState.Positive },
               new() { Title = "پتروشیمی", IconCssClass = "bi bi-droplet-fill", IconBgCssClass = "petro", Value = "۴.۲ همت", Change = "-۱.۲٪", ChangeState = ValueState.Negative },
               new() { Title = "کشاورزی", IconCssClass = "bi bi-tree-fill", IconBgCssClass = "agri", Value = "۰.۹ همت", Change = "+۵.۴٪", ChangeState = ValueState.Positive }
           }
        };
        newsData = new NewsData
        {
            Items = new List<NewsItem>
            {
                new()
                {
                    Category = NewsCategory.HotGroup,
                    MarketGroup = MarketGroup.Steel,
                    Source = "گروه داغ • فولاد",
                    Title = "افزایش تقاضا برای ورق سرد، قیمت‌ها را در گروه فولاد بالا برد"
                },
                new()
                {
                    Category = NewsCategory.SupplyAnnouncement,
                    MarketGroup = MarketGroup.Cement,
                    Source = "اطلاعیه عرضه",
                    Title = "عرضه جدید سیمان تیپ ۲ تهران برای هفته آینده تایید شد"
                },
                new()
                {
                    Category = NewsCategory.HotGroup,
                    MarketGroup = MarketGroup.Petrochemical,
                    Source = "گروه داغ • پتروشیمی",
                    Title = "رقابت سنگین بر سر پلیمرهای مهندسی در تالار پتروشیمی"
                }
            }
        };
    }
}

